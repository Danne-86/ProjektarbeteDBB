<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/stylesheets/style.css" />
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="mx-auto max-w-7xl p-6">
      <h1 class="text-2xl font-bold mb-2"><%= title %></h1>
      <form method="GET" action="/admin" class="my-6">
        <input type="hidden" name="flagged" value="<%= showFlagged ? false : true %>" />
        <button
          type="submit"
          class="flex items-center px-4 py-2 border rounded hover:bg-purple-700 hover:text-white <%= showFlagged ? 'bg-purple-700 text-white' : 'bg-white' %>"
        >
          <svg
            class="shrink-0 inline w-4 h-4 m-1 me-3 <%= showFlagged ? 'text-white' : 'text-red-800' %>"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"
            />
          </svg>
          <span class="me-1">Filter flagged</span>
        </button>
      </form>

      <% const filteredComments = showFlagged ? comments.filter(comment => comment.is_flagged) : comments;
      const filteredPosts = showFlagged ? posts.filter(post => post.is_flagged ||
      filteredComments.some(comment => comment.post_id === post.id)) : posts; %>

      <div class="overflow-x-auto bg-white rounded-md shadow mb-6">
        <table class="w-full text-left border-collapse">
          <thead class="bg-gray-200 text-gray-700">
            <tr>
              <th class="w-6 text-center">
                <svg
                  class="shrink-0 inline w-4 h-4 m-1"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"
                  />
                </svg>
              </th>
              <th class="px-1 py-2"></th>
              <th class="px-1 py-2">
                <div class="flex items-center">
                  <p>User</p>
                </div>
              </th>
              <th class="px-1 py-2 hidden lg:block">
                <div class="flex items-center">
                  <p>Date</p>
                </div>
              </th>
              <th class="px-1 py-2 text-center">
                <div class="flex items-center">
                  <p>Unflag</p>
                </div>
              </th>
              <th class="px-1 text-center">
                <div class="flex items-center">
                  <p>Delete</p>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <% filteredPosts.forEach((post) => { %>
            <!-- Post -->
            <tr class="bg-purple-50 hover:bg-purple-100">
              <td class="px-1 text-red-800 text-center">
                <% if (post.is_flagged == true) { %>
                <svg
                  class="shrink-0 inline w-4 h-4 m-1"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"
                  />
                </svg>
                <% } %>
              </td>
              <td class="px-1 font-semibold">
                <a href="/posts/<%= post.id %>" class="text-gray-700 hover:text-purple-700 hover:underline">
                  <button class="flex items-center">
                    <div
                      class="me-2 flex items-center text-purple-700 border border-purple-300 rounded bg-purple-50 hover:bg-purple-700 hover:text-white"
                    >
                      <svg
                        class="shrink-0 inline w-4 h-4 m-1"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M11.403 5H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-6.403a3.01 3.01 0 0 1-1.743-1.612l-3.025 3.025A3 3 0 1 1 9.99 9.768l3.025-3.025A3.01 3.01 0 0 1 11.403 5Z"
                          clip-rule="evenodd"
                        />
                        <path
                          fill-rule="evenodd"
                          d="M13.232 4a1 1 0 0 1 1-1H20a1 1 0 0 1 1 1v5.768a1 1 0 1 1-2 0V6.414l-6.182 6.182a1 1 0 0 1-1.414-1.414L17.586 5h-3.354a1 1 0 0 1-1-1Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                    <p><%= post.header %></p>
                  </button>
                </a>
              </td>
              <td class="px-1">
                <a href="/blog/<%= post.user_id %>">
                  <button class="text-gray-700 flex items-center hover:text-purple-700 hover:underline">
                    <div class="flex items-center">
                      <svg
                        class="shrink-0 inline w-4 h-4 m-1"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M12 20a7.966 7.966 0 0 1-5.002-1.756l.002.001v-.683c0-1.794 1.492-3.25 3.333-3.25h3.334c1.84 0 3.333 1.456 3.333 3.25v.683A7.966 7.966 0 0 1 12 20ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10c0 5.5-4.44 9.963-9.932 10h-.138C6.438 21.962 2 17.5 2 12Zm10-5c-1.84 0-3.333 1.455-3.333 3.25S10.159 13.5 12 13.5c1.84 0 3.333-1.455 3.333-3.25S13.841 7 12 7Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                    <p><%= post.username %></p>
                  </button>
                </a>
              </td>
              <td class="px-1 hidden lg:block">
                <div class="flex items-center text-gray-700">
                  <svg
                    class="w-4 h-4 inline m-1"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M5 5a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1 2 2 0 0 1 2 2v1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a2 2 0 0 1 2-2ZM3 19v-7a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Zm6.01-6a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm-10 4a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <p><%= post.created_at %></p>
                </div>
              </td>
              <td class="px-1">
                <% if (post.is_flagged == true) { %>
                <form action="/admin/posts/unflag" method="POST">
                  <input type="hidden" name="showFlagged" value="<%= showFlagged %>" />
                  <button
                    type="submit"
                    name="id"
                    value="<%= post.id %>"
                    class="flex items-center p-1 text-green-800 border border-green-300 rounded bg-green-50 hover:text-white hover:bg-green-700"
                  >
                    <svg
                      class="shrink-0 inline w-4 h-4 m-1"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M5 14v7M5 4.971v9.541c5.6-5.538 8.4 2.64 14-.086v-9.54C13.4 7.61 10.6-.568 5 4.97Z"
                      />
                    </svg>
                  </button>
                </form>
                <% } %>
              </td>
              <td class="px-1">
                <form action="/admin/posts/delete" method="POST">
                  <input type="hidden" name="showFlagged" value="<%= showFlagged %>" />
                  <button
                    type="submit"
                    name="id"
                    value="<%= post.id %>"
                    class="flex items-center p-1 text-red-800 border border-red-300 rounded bg-red-50 hover:text-white hover:bg-red-700"
                  >
                    <svg
                      class="shrink-0 inline w-4 h-4 m-1"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </button>
                </form>
              </td>
            </tr>

            <% filteredComments.forEach((comment) => { %> <% if (comment.post_id === post.id) { %>
            <!-- Comment -->
            <tr class="hover:bg-purple-100">
              <td class="px-1 text-red-800 text-center">
                <% if (comment.is_flagged == true) { %>
                <svg
                  class="shrink-0 inline w-4 h-4 m-1"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M13.09 3.294c1.924.95 3.422 1.69 5.472.692a1 1 0 0 1 1.438.9v9.54a1 1 0 0 1-.562.9c-2.981 1.45-5.382.24-7.25-.701a38.739 38.739 0 0 0-.622-.31c-1.033-.497-1.887-.812-2.756-.77-.76.036-1.672.357-2.81 1.396V21a1 1 0 1 1-2 0V4.971a1 1 0 0 1 .297-.71c1.522-1.506 2.967-2.185 4.417-2.255 1.407-.068 2.653.453 3.72.967.225.108.443.216.655.32Z"
                  />
                </svg>
                <% } %>
              </td>
              <td class="px-6 text-xs text-gray-700">
                <div class="flex items-center">
                  <svg
                    class="shrink-0 inline w-4 h-4 m-1"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M3.559 4.544c.355-.35.834-.544 1.33-.544H19.11c.496 0 .975.194 1.33.544.356.35.559.829.559 1.331v9.25c0 .502-.203.981-.559 1.331-.355.35-.834.544-1.33.544H15.5l-2.7 3.6a1 1 0 0 1-1.6 0L8.5 17H4.889c-.496 0-.975-.194-1.33-.544A1.868 1.868 0 0 1 3 15.125v-9.25c0-.502.203-.981.559-1.331ZM7.556 7.5a1 1 0 1 0 0 2h8a1 1 0 0 0 0-2h-8Zm0 3.5a1 1 0 1 0 0 2H12a1 1 0 1 0 0-2H7.556Z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <p><%= comment.content %></p>
                </div>
              </td>
              <td class="px-1">
                <a href="/blog/<%= comment.user_id %>">
                  <button class="text-gray-700 flex items-center hover:text-purple-700 hover:underline">
                    <div class="flex items-center">
                      <svg
                        class="shrink-0 inline w-4 h-4 m-1"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M12 20a7.966 7.966 0 0 1-5.002-1.756l.002.001v-.683c0-1.794 1.492-3.25 3.333-3.25h3.334c1.84 0 3.333 1.456 3.333 3.25v.683A7.966 7.966 0 0 1 12 20ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10c0 5.5-4.44 9.963-9.932 10h-.138C6.438 21.962 2 17.5 2 12Zm10-5c-1.84 0-3.333 1.455-3.333 3.25S10.159 13.5 12 13.5c1.84 0 3.333-1.455 3.333-3.25S13.841 7 12 7Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                    <p><%= comment.username %></p>
                  </button>
                </a>
              </td>
              <td class="px-1 hidden lg:block">
                <div class="flex items-center text-gray-700">
                  <svg
                    class="w-4 h-4 inline m-1"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M5 5a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1h1a1 1 0 0 0 1-1 1 1 0 1 1 2 0 1 1 0 0 0 1 1 2 2 0 0 1 2 2v1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a2 2 0 0 1 2-2ZM3 19v-7a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Zm6.01-6a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm-10 4a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0Zm2 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0Z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <p><%= comment.created_at %></p>
                </div>
              </td>
              <td class="px-1">
                <% if (comment.is_flagged == true) { %>
                <form action="/admin/comments/unflag" method="POST">
                  <input type="hidden" name="showFlagged" value="<%= showFlagged %>" />
                  <button
                    type="submit"
                    name="id"
                    value="<%= comment.id %>"
                    class="flex items-center p-1 text-green-800 border border-green-300 rounded bg-green-50 hover:text-white hover:bg-green-700"
                  >
                    <svg
                      class="shrink-0 inline w-4 h-4 m-1"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M5 14v7M5 4.971v9.541c5.6-5.538 8.4 2.64 14-.086v-9.54C13.4 7.61 10.6-.568 5 4.97Z"
                      />
                    </svg>
                  </button>
                </form>
                <% } %>
              </td>
              <td class="px-1">
                <form action="/admin/comments/delete" method="POST">
                  <input type="hidden" name="showFlagged" value="<%= showFlagged %>" />
                  <button
                    type="submit"
                    name="id"
                    value="<%= comment.id %>"
                    class="flex items-center p-1 text-red-800 border border-red-300 rounded bg-red-50 hover:text-white hover:bg-red-700"
                  >
                    <svg
                      class="shrink-0 inline w-4 h-4 m-1"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M8.586 2.586A2 2 0 0 1 10 2h4a2 2 0 0 1 2 2v2h3a1 1 0 1 1 0 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8a1 1 0 0 1 0-2h3V4a2 2 0 0 1 .586-1.414ZM10 6h4V4h-4v2Zm1 4a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Zm4 0a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0v-8Z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </button>
                </form>
              </td>
            </tr>
            <!-- End Comment -->
            <% }}) %>
            <!-- End Post -->
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
